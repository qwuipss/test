# C# API Client for Moira

[![NuGet](https://img.shields.io/nuget/v/Moira.ApiClient.svg)](https://www.nuget.org/packages/Moira.ApiClient)
If you're new here, better check out our main [README](https://github.com/moira-alert/moira/blob/master/README.md).

## Overview

This API client was generated by the [Microsoft Kiota](https://aka.ms/kiota/docs) tool.

Our current documentation is available on [swaggerhub](https://app.swaggerhub.com/apis/Moira/moira-alert/master).

## Installation

Install with dotnet CLI:

```text
dotnet add package Moira.ApiClient
```

If you have not implemented `Microsoft.Kiota.Abstractions.IRequestAdapter` also add `Microsoft.Kiota.Http.HttpClientLibrary` package.

```text
dotnet add package Microsoft.Kiota.Http.HttpClientLibrary
```

## Getting started

Initialize client:

```csharp
// Use HttpClientRequestAdapter from Microsoft.Kiota.Http.HttpClientLibrary or your own implementation
var requestAdapter = new HttpClientRequestAdapter(new AnonymousAuthenticationProvider());

// Create new client with specified IRequestAdapter
var client = new MoiraApiClient(requestAdapter);
```

## Trigger

### Create trigger

```csharp
var trigger = new Trigger
{
    Name = "Trigger name",
    Desc = "Trigger description",
    Tags = new List<string> { "service" },
    Targets = new List<string> { "prefix.service.*.postfix"},
    WarnValue = 300,
    ErrorValue = 600,
    TriggerType = "rising",
    Sched = new ScheduleData
    {
        Days =
        [
            new ScheduleDataDay { Name = ScheduleDataDay_name.Mon, Enabled = true },
            new ScheduleDataDay { Name = ScheduleDataDay_name.Tue, Enabled = false },
        ],
        // From 01:00 to 23:00 GMT +05:00
        StartOffset = (int)TimeSpan.FromHours(1).TotalMinutes,
        EndOffset = (int)TimeSpan.FromHours(23).TotalMinutes,
        TzOffset = (int)TimeSpan.FromHours(-5).TotalMinutes,
    },
    // ...
};

var response = await client.Trigger.PutAsync(trigger);

// Get ID of created trigger
var triggerId = response.Id;
```

### Update trigger

```csharp
var updatedTrigger = new Trigger
{
    Desc = "New trigger description"
    // ...
};

await client.Trigger["trigger_id"].PutAsync(trigger);
```

### Get all triggers

```csharp
var response = await client.Trigger.GetAsync();

// Get count of all triggers
var totalTriggers = response.Total;
```

### Put trigger under maintenance

```csharp
await client.Trigger["trigger_id"].SetMaintenance.PutAsync(new TriggerMaintenance
{
    // Put trigger under maintenance for 15 minutes
    Trigger = DateTimeOffset.UtcNow.ToUnixTimeSeconds() + (int)TimeSpan.FromMinutes(15).TotalSeconds
})
```

### Delete trigger

```csharp
await client.Trigger["trigger_id"].DeleteAsync();
```

## Contact

### Create contact

```csharp
var contact = new Contact
{
    Name = "Name",
    Type = "telegram",
    Value = "@telegram_chat",
    User = "User"
};

await client.Contact.PutAsync(contact);
```

### Delete contact

```csharp
await client.Contact["contact_id"].DeleteAsync();
```

## Team

### Create team

```csharp
var team = new TeamModel
{
    Name = "Name",
    Description = "Team description",
};

await client.Teams.PostAsync(team);
```

### Delete team

```csharp
await client.Teams["team_id"].DeleteAsync();
```

## Subscription

### Create subscription

```csharp
var subscription = new Subscription
{
    Contacts = new List<string> { "contact_id" },
    Enabled = true,
    IgnoreRecoverings = true,
    IgnoreWarnings = false,
    Tags = new List<string> { "Tag" },
    TeamId = "team_id"
};

await client.Subscription.PutAsync(subscription);
```

### Add subscription to team

```csharp
await client.Teams["team_id"].Subscriptions.PostAsync(subscription);
```

### Delete subscription

```csharp
await client.Subscription["subscription_id"].DeleteAsync();
```
